<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UG NEP Semester Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            
            background-size: cover;
            background-attachment: fixed;
        }
        .container {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.9);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
        }
        .animate-pulse-slow {
            animation: pulse-slow 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background: linear-gradient(to right, #3B82F6, #1D4ED8);
            color: white;
        }
        .college-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .college-item:hover {
            background-color: #F3F4F6;
        }
        .college-item.selected {
            background-color: #3B82F6;
            color: white;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div class="container mx-auto p-6 sm:p-10 shadow-2xl rounded-3xl max-w-4xl w-full">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center text-gray-800 mb-6 drop-shadow-md">
            RMLAU Results Portal
        </h1>
        <p class="text-center text-gray-600 mb-8 max-w-prose mx-auto">
            Your single-stop solution for all UG NEP semester results. Select your semester to get started.
        </p>
        
        <div class="flex flex-col md:flex-row items-center justify-between mb-8 space-y-4 md:space-y-0 md:space-x-6">
            <div class="w-full md:w-1/2">
                <label for="semesterSelect" class="block text-gray-700 font-bold mb-2">Select Your Semester:</label>
                <select id="semesterSelect" class="w-full p-4 border-2 border-blue-400 rounded-xl bg-white text-gray-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-300">
                    <option value="first">1st Semester</option>
                    <option value="second">2nd Semester</option>
                    <option value="third">3rd Semester</option>
                    <option value="fourth">4th Semester</option>
                    <option value="fifth">5th Semester</option>
                    <option value="sixth">6th Semester</option>
                </select>
            </div>
            
            <a href="https://rmlau.mnopdf.com/" target="_blank" class="w-full md:w-1/2 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 animate-pulse-slow">
                <span class="mr-2">ðŸ“š</span> Download Previous Year Papers of RMLAU
            </a>
        </div>

        <div class="shadow-xl rounded-2xl w-full">
            <table class="w-full text-sm text-left text-gray-600 table-auto">
                <thead class="text-xs text-gray-800 uppercase bg-blue-100 border-b-2 border-blue-200">
                    <tr>
                        <th scope="col" class="py-4 px-2 sm:px-4 md:px-6">S.NO.</th>
                        <th scope="col" class="py-4 px-2 sm:px-4 md:px-6">Courses</th>
                        <th scope="col" class="py-4 px-2 sm:px-4 md:px-6 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>

        <div class="mt-10 text-center text-gray-700">
            <p class="text-lg font-medium mb-4">
                For any confusion or problems, contact me:
            </p>
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-6">
                <a href="https://wa.me/919838225780" target="_blank" class="flex items-center bg-green-500 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.04 2c-5.46 0-9.92 4.46-9.92 9.96 0 1.77.47 3.45 1.35 4.95L2 22l5.24-1.39a11.832 11.832 0 004.8-1.04c5.49 0 9.96-4.46 9.96-9.96C22 6.46 17.53 2 12.04 2zm3.84 14.35a.8.8 0 01-.54.32c-.59.16-3.4.9-3.95 1.05-.18.06-.39.09-.6.09-.43 0-.82-.12-1.14-.37-.28-.21-.61-.59-.83-.89-.22-.3-.66-.99-.66-2.61a3.682 3.682 0 01.37-1.5c.29-.5.62-.89.92-1.2.3-.31.62-.57.9-.76.28-.2.53-.32.65-.32.12 0 .28-.01.44-.01.35 0 .7.13.9.33.2.2.49.56.7.83.2.28.32.6.43.76.1.16.2.31.29.41a.8.8 0 00.5.38c.15.06.32.06.47.01.21-.06.74-.29 1.4-.64.65-.34 1.09-.6 1.3-.72.22-.11.4-.23.57-.3.17-.07.38-.11.59-.11.21 0 .4.06.59.15.19.09.43.2.66.43.23.23.4.52.5.76.1.25.16.48.16.7 0 .21-.06.4-.15.59-.1.19-.24.4-.4.59-.17.18-.32.32-.47.41a.8.8 0 01-.6.18z"/>
                    </svg>
                    WhatsApp 9838225780
                </a>
                <a href="https://www.instagram.com/vaikartana_raj" target="_blank" class="flex items-center bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07c3.279.172 4.673 1.637 4.846 4.85.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.173 3.213-1.567 4.646-4.846 4.846-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-3.279-.173-4.673-1.637-4.846-4.85-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.173-3.213 1.567-4.646 4.846-4.846C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.704 0 8.334.01 7.005.068 3.442.247.98 2.79.799 6.354.74 7.684.73 8.054.73 12s.01 4.316.068 5.646c.18 3.563 2.723 6.096 6.297 6.277 1.33.058 1.7.068 5.006.068s4.316-.01 5.646-.068c3.563-.18 6.126-2.713 6.307-6.277.058-1.33.068-1.7.068-5.006s-.01-4.316-.068-5.646C23.277 2.79 20.714.247 17.151.066 15.821.01 15.451 0 12 0zm0 4.295a7.705 7.705 0 100 15.41 7.705 7.705 0 000-15.41zm0 2.5a5.205 5.205 0 110 10.41 5.205 5.205 0 010-10.41zm6.205-.724a1.815 1.815 0 110 3.63 1.815 1.815 0 010-3.63z"/>
                    </svg>
                    Instagram @Vaikartana_Raj
                </a>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Get Your Result</h2>
            
            <!-- Tab buttons -->
            <div class="flex mb-4 bg-gray-200 rounded-lg p-1">
                <button id="rollNoTab" class="tab-button flex-1 py-2 px-4 rounded-md font-semibold active">
                    Enter Roll No.
                </button>
                <button id="collegeTab" class="tab-button flex-1 py-2 px-4 rounded-md font-semibold">
                    Select College
                </button>
            </div>
            
            <!-- Roll Number Input Tab -->
            <div id="rollNoContent" class="tab-content">
                <p id="validationMessage" class="text-sm text-red-600 mb-2"></p>
                <input type="text" id="rollNoInput" class="w-full p-3 mb-4 border-2 border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300" placeholder="e.g., 23040100410075">
            </div>
            
            <!-- College Selection Tab -->
            <div id="collegeContent" class="tab-content" style="display: none;">
                <p id="collegeValidationMessage" class="text-sm text-red-600 mb-2"></p>
                <input type="text" id="collegeSearch" class="w-full p-3 mb-4 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300" placeholder="Search by college name or code...">
                <div id="collegeList" class="max-h-48 overflow-y-auto border rounded-lg">
                    <div class="p-4 text-center text-gray-500">Loading colleges...</div>
                </div>
                <input type="hidden" id="selectedCollegeCode">
                <p id="selectedCollegeDisplay" class="text-sm text-blue-600 mt-2"></p>
            </div>
            
            <button onclick="validateAndRedirect()" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-700 transition duration-300 mt-4">
                SHOW RESULTS
            </button>
            <button onclick="closeModal()" class="w-full bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-xl hover:bg-gray-500 transition duration-300 mt-2">
                Cancel
            </button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAm5zfkAWm6Dq_DWBNcLv7kaBKlu7C66WU",
            authDomain: "rmlau-rank-wise-result.firebaseapp.com",
            projectId: "rmlau-rank-wise-result",
            storageBucket: "rmlau-rank-wise-result.firebasestorage.app",
            messagingSenderId: "1069341171195",
            appId: "1:1069341171195:web:5af12e9ada7b4dac90ff5e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const semesterLinks = {
            'first': 'UG_NEPI',
            'second': 'UG_NEPII',
            'third': 'UG_NEPIII',
            'fourth': 'UG_NEPIV',
            'fifth': 'UG_NEPV',
            'sixth': 'UG_NEPVITH'
        };

        const courses = {
            'first': [
                { name: 'BACHELOR OF ARTS (B.A.)', id: 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=' },
                { name: 'BACHELOR OF COMMERCE (B.COM.)', id: 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ09NLik=' },
                { name: 'BACHELOR OF SCIENCE (B.SC.)', id: 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TQy4p' }
            ],
            'second': [
                { name: 'BACHELOR OF ARTS (B.A.)', id: 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=' },
                { name: 'BACHELOR OF COMMERCE (B.Com.)', id: 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ29tLik=' },
                { name: 'BACHELOR OF SCIENCE (B.Sc.)', id: 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TYy4p' }
            ],
            'third': [
                { name: 'BACHELOR OF ARTS (B.A.)', id: 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=' },
                { name: 'BACHELOR OF COMMERCE (B.COM)', id: 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ09NKQ==' },
                { name: 'BACHELOR OF SCIENCE (B.SC.)', id: 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TQy4p' }
            ],
            'fourth': [
                { name: 'BACHELOR OF ARTS (B.A.)', id: 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=' },
                { name: 'BACHELOR OF COMMERCE (B.Com.)', id: 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ29tLik=' },
                { name: 'BACHELOR OF SCIENCE (B.Sc.)', id: 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TYy4p' }
            ],
            'fifth': [
                { name: 'BACHELOR OF ARTS (B.A.)', id: 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=' },
                { name: 'BACHELOR OF COMMERCE (B.Com.)', id: 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ29tLik=' },
                { name: 'BACHELOR OF SCIENCE (B.Sc.)', id: 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TYy4p' }
            ],
            'sixth': [
                { name: 'BACHELOR OF ARTS (B.A.)', id: 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=' },
                { name: 'BACHELOR OF COMMERCE (B.Com.)', id: 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ29tLik=' },
                { name: 'BACHELOR OF SCIENCE (B.Sc.)', id: 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TYy4p' }
            ]
        };

        let currentClassId = '';
        let allColleges = [];
        let selectedCollegeCode = '';
        const modal = document.getElementById('resultModal');
        const rollNoInput = document.getElementById('rollNoInput');
        const validationMessage = document.getElementById('validationMessage');
        const collegeValidationMessage = document.getElementById('collegeValidationMessage');
        const semesterSelect = document.getElementById('semesterSelect');
        const tableBody = document.getElementById('tableBody');
        const collegeSearch = document.getElementById('collegeSearch');
        const collegeList = document.getElementById('collegeList');
        const selectedCollegeDisplay = document.getElementById('selectedCollegeDisplay');

        // Tab functionality
        const rollNoTab = document.getElementById('rollNoTab');
        const collegeTab = document.getElementById('collegeTab');
        const rollNoContent = document.getElementById('rollNoContent');
        const collegeContent = document.getElementById('collegeContent');

        rollNoTab.addEventListener('click', () => {
            rollNoTab.classList.add('active');
            collegeTab.classList.remove('active');
            rollNoContent.style.display = 'block';
            collegeContent.style.display = 'none';
        });

        collegeTab.addEventListener('click', () => {
            collegeTab.classList.add('active');
            rollNoTab.classList.remove('active');
            rollNoContent.style.display = 'none';
            collegeContent.style.display = 'block';
        });

        // Load colleges from Firebase
        async function loadColleges() {
            try {
                const snapshot = await db.collection('colleges').get();
                allColleges = [];
                snapshot.forEach(doc => {
                    allColleges.push({
                        code: doc.id,
                        name: doc.data().name
                    });
                });
                allColleges.sort((a, b) => a.name.localeCompare(b.name));
                displayColleges(allColleges);
            } catch (error) {
                console.error('Error loading colleges:', error);
                collegeList.innerHTML = '<div class="p-4 text-center text-red-500">Error loading colleges</div>';
            }
        }

        function displayColleges(colleges) {
            if (colleges.length === 0) {
                collegeList.innerHTML = '<div class="p-4 text-center text-gray-500">No colleges found</div>';
                return;
            }

            collegeList.innerHTML = colleges.map(college => 
                `<div class="college-item p-3 border-b hover:bg-gray-50 cursor-pointer" 
                      onclick="selectCollege('${college.code}', '${college.name.replace(/'/g, "\\'")}')">
                    <div class="font-semibold">${college.name}</div>
                    <div class="text-sm text-gray-500">Code: ${college.code}</div>
                </div>`
            ).join('');
        }

        function selectCollege(code, name) {
            selectedCollegeCode = code;
            document.getElementById('selectedCollegeCode').value = code;
            selectedCollegeDisplay.textContent = `Selected: ${name} (${code})`;
            
            // Update visual selection
            document.querySelectorAll('.college-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            collegeValidationMessage.textContent = '';
        }

        // College search functionality
        collegeSearch.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredColleges = allColleges.filter(college => 
                college.name.toLowerCase().includes(searchTerm) || 
                college.code.toLowerCase().includes(searchTerm)
            );
            displayColleges(filteredColleges);
        });

        function renderTable(semester) {
            tableBody.innerHTML = '';
            const semesterCourses = courses[semester];
            if (semesterCourses) {
                semesterCourses.forEach((course, index) => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white border-b hover:bg-gray-50 transition duration-150 ease-in-out';
                    row.innerHTML = `
                        <td class="py-4 px-6 font-medium text-gray-900 whitespace-nowrap">${index + 1}</td>
                        <td class="py-4 px-6 course-name font-semibold">${course.name}</td>
                        <td class="py-4 px-6">
                            <button onclick="showResultModal('${course.id}')" class="bg-green-600 text-white font-bold py-2 px-4 rounded-xl shadow-md hover:bg-green-700 transition duration-300 transform hover:scale-105">
                                GET RESULT
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        function showResultModal(id) {
            currentClassId = id;
            modal.style.display = "flex";
            rollNoInput.value = '';
            selectedCollegeCode = '';
            document.getElementById('selectedCollegeCode').value = '';
            selectedCollegeDisplay.textContent = '';
            validationMessage.textContent = '';
            collegeValidationMessage.textContent = '';
            collegeSearch.value = '';
            
            // Reset to first tab
            rollNoTab.click();
            
            // Load colleges if not already loaded
            if (allColleges.length === 0) {
                loadColleges();
            } else {
                displayColleges(allColleges);
            }
        }

        function closeModal() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        function base64Encode(str) {
            return btoa(str);
        }

        function getSemesterPrefix(semester) {
            if (semester === 'first' || semester === 'second') return '24';
            if (semester === 'third' || semester === 'fourth') return '23';
            if (semester === 'fifth' || semester === 'sixth') return '22';
            return '24';
        }

        function getCourseValue(classId) {
            if (classId === 'QkFDSEVMT1IgT0YgQVJUUyAoQi5BLik=') return '1';
            if (['QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ09NLik=', 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ29tLik=', 'QkFDSEVMT1IgT0YgQ09NTUVSQ0UgKEIuQ09NKQ=='].includes(classId)) return '2';
            if (['QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TQy4p', 'QkFDSEVMT1IgT0YgU0NJRU5DRSAoQi5TYy4p'].includes(classId)) return '4';
            return '1';
        }

        function validateAndRedirect() {
            const currentSemester = semesterSelect.value;
            const isRollNoTab = rollNoTab.classList.contains('active');
            validationMessage.textContent = '';
            collegeValidationMessage.textContent = '';

            let rollNo = '';

            if (isRollNoTab) {
                // Roll number input validation
                rollNo = rollNoInput.value;
                
                if (!rollNo) {
                    validationMessage.textContent = "Please enter a roll number.";
                    return;
                }

                const expectedPrefix = getSemesterPrefix(currentSemester);
                const rollNoPrefix = rollNo.substring(0, 2);
                
                if (!/^\d{14}$/.test(rollNo)) {
                    validationMessage.textContent = "Roll No. must be a 14-digit number.";
                    return;
                }
                
                if (rollNoPrefix !== expectedPrefix) {
                    validationMessage.textContent = `Roll No. must start with '${expectedPrefix}' for the selected semester.`;
                    return;
                }
            } else {
                // College selection validation
                if (!selectedCollegeCode) {
                    collegeValidationMessage.textContent = "Please select a college.";
                    return;
                }

                // Generate roll number based on selections
                const semesterPrefix = getSemesterPrefix(currentSemester);
                const courseValue = getCourseValue(currentClassId);
                const collegeCode = selectedCollegeCode.padStart(4, '0');
                
                const semesterSuffixes = {
                    'first': '01',
                    'second': '02',
                    'third': '03',
                    'fourth': '04',
                    'fifth': '05',
                    'sixth': '06'
                };
                const semesterSuffix = semesterSuffixes[currentSemester];
                
                // Format: [prefix][0][courseValue][01][collegeCode][00][semesterSuffix]
                rollNo = `${semesterPrefix}0${courseValue}01${collegeCode}00${semesterSuffix}`;
            }

            // Proceed with existing logic for URL generation
            const semesterSuffixes = {
                'first': '01',
                'second': '02',
                'third': '03',
                'fourth': '04',
                'fifth': '05',
                'sixth': '06'
            };
            const semesterSuffix = semesterSuffixes[currentSemester];
            const rollNoBase = rollNo.slice(0, 12) + semesterSuffix;
            const rollNoBaseEncoded = base64Encode(rollNoBase);

            let encodedPart = '';
            const sixthDigit = rollNo.charAt(6);
            if (sixthDigit === '0') {
                const partToEncode = rollNo.substring(7, 10);
                encodedPart = base64Encode(partToEncode);
            } else {
                const partToEncode = rollNo.substring(6, 10);
                encodedPart = base64Encode(partToEncode);
            }

            const semesterUrlPart = semesterLinks[currentSemester];
            
            // Construct the final URL and correctly encode it
            const finalUrl = `https://result25.rmlauexams.in/Marks_Sheet/${semesterUrlPart}/print.aspx?Roll_no=${rollNoBaseEncoded}&Col=${encodedPart}&Class=${currentClassId}`;
            const encodedFinalUrl = encodeURIComponent(finalUrl);

            // Open the new page with the correctly encoded URL
            window.open(`https://realsaanvi.github.io/rmlau/Pages/getdata.html?url=${encodedFinalUrl}`, '_blank');
            closeModal();
        }

        // Initial render
        document.addEventListener('DOMContentLoaded', () => {
            renderTable(semesterSelect.value);
        });

        // Event listener for semester selection change
        semesterSelect.addEventListener('change', (event) => {
            renderTable(event.target.value);
        });
    </script>
</body>
</html>